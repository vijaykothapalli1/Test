<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>TIBCO2MuleSoft - ProwessSoft</title>
      <link rel="shortcut icon" th:href="@{/images/favicon.ico}" />
      <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
      <link rel="stylesheet" th:href="@{/css/typography.css}">
      <link rel="stylesheet" th:href="@{/css/style.css}">
      <link rel="stylesheet" th:href="@{/css/responsive.css}">
   </head>
   <body>
      <!-- loader Start -->
      <div id="loading">
         <div id="loading-center">
            <div class="loader">
               <div class="cube">
                  <div class="sides">
                     <div class="top"></div>
                     <div class="right"></div>
                     <div class="bottom"></div>
                     <div class="left"></div>
                     <div class="front"></div>
                     <div class="back"></div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- loader END -->
      <!-- Wrapper Start -->
      <div class="wrapper">
         <!-- Sidebar  -->
         <div th:replace="common/sidebar::sidebar"></div>
         <!-- TOP Nav Bar -->
         <div th:replace="common/topbar::topbar"></div>
         <!-- TOP Nav Bar END -->
         <!-- Page Content  -->
         <div id="content-page" class="content-page">
            <div class="container-fluid">
               <div class="row">
               <div class="col-sm-8 col-lg-8">
                     <div class="iq-card">
                        <div class="iq-card-header d-flex justify-content-between">
                           <div class="iq-header-title">
                              <h4 class="card-title">Project Upload Form</h4>
                           </div>
                        </div>
                        <div class="iq-card-body">
                           <p></p>
                           <form enctype="multipart/form-data" id="uploadForm">
                             <div class="form-group">
                             <label for="pwd">Input Type</label>
                                 <div class="custom-control custom-radio custom-control">
                                    <input type="radio" id="zip_project" name=input_type class="custom-control-input" value="designtime">
                                    <label class="custom-control-label" for="zip_project"> Project Source zip file</label>
                                 </div>
                                   <div class="custom-control custom-radio custom-control">
                                    <input type="radio" id="zip_extract" name="input_type" class="custom-control-input" value="runtime">
                                    <label class="custom-control-label" for="zip_extract"> App Manage extract zip file</label>
                                 </div>
                              </div>
                              
                              <div class="form-group">
                              <label>Zip File</label>
                                 <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="input_file" name="input_file" accept=".zip">
                                    <label class="custom-file-label" for="input_file">Choose file</label>
                                 </div>
                              </div>
                              
                              <div class="form-group">
                              
                              
                              <label>Mule Config File </label> <a href="#" id="downloadSample"> (Download sample)</a>
                                <div class="input-group">
								  <div class="custom-file">
								    <input type="file" class="custom-file-input" id="config_file" name="config_file" accept=".yaml">
								    <label class="custom-file-label" for="config_file">Choose Mule configuration file</label>
								  </div>
								  <!-- 
								  <div class="input-group-append">
								  
								    <button type="button" id="downloadSample1" class="btn btn-primary mb-3" data-toggle="tooltip" data-placement="top" title="" data-original-title="Download sample config"><i class="ri-download-2-line pr-0"></i></button>
								  </div>
								  -->
								</div>
								
                              </div>

                              
                              <button type="button" class="btn btn-primary" id="uploadBtn">Upload</button>
                              <button type="reset" class="btn iq-bg-danger">Cancel</button>
                           </form>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-4 col-lg-4">
                     <div class="iq-card">
                        <div class="iq-card-header d-flex justify-content-between">
                           <div class="iq-header-title">
                              <h4 class="card-title">Instructions</h4>
                           </div>
                        </div>
                        <div class="iq-card-body">
                        <ul style="list-style: square;padding-left: 20px;">
                        <li>Automated conversion of TIBCO projects/domain to Mule APIs.</li>
                        <li>Upload a TIBCO project zip or AppManage extract from a TIBCO Domain. </li>
                        <li>Mule config file should have the information to access the organization and publish the projects to Design Center and Exchange.</li>
                        </ul>
                           
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- Wrapper END -->
      <!-- Footer -->
      <footer class="bg-white iq-footer">
         <div class="container-fluid">
            <div class="row">
               <div class="col-lg-6">
                  <ul class="list-inline mb-0">
                     <li class="list-inline-item"><a href="privacy-policy.html">Privacy Policy</a></li>
                     <li class="list-inline-item"><a href="terms-of-service.html">Terms of Use</a></li>
                  </ul>
               </div>
               <div class="col-lg-6 text-right">
                  Copyright 2020 <a href="#">ProwessSoft</a> All Rights Reserved.
               </div>
            </div>
         </div>
      </footer>
      <!-- Footer END -->
      	<script>
	var baseUrl = "[[${BASE_URL}]]";
	</script>
      <script th:src="@{/js/jquery.min.js}"></script>
      <script th:src="@{/js/popper.min.js}"></script>
      <script th:src="@{js/bootstrap.min.js}"></script>
      <script th:src="@{js/jquery.appear.js}"></script>
      <script th:src="@{js/countdown.min.js}"></script>
      <script th:src="@{js/waypoints.min.js}"></script>
      <script th:src="@{js/jquery.counterup.min.js}"></script>
      <script th:src="@{js/wow.min.js}"></script>
      <script th:src="@{js/apexcharts.js}"></script>
      <script th:src="@{js/slick.min.js}"></script>
      <script th:src="@{js/select2.min.js}"></script>
      <script th:src="@{js/owl.carousel.min.js}"></script>
      <script th:src="@{js/jquery.magnific-popup.min.js}"></script>
      <script th:src="@{js/smooth-scrollbar.js}" type="text/javascript"></script>
      <script th:src="@{js/chart-custom.js}"></script>
      <script th:src="@{js/custom.js}"></script>
      <script type="text/javascript">

      
      

      $( document ).ready(function() {

    	  $('input[type="file"]').change(function(e){
    	        var fileName = e.target.files[0].name;
    	        $(e.target).parent('div').find('label').html(fileName)
    	    });
       
    	  function sendRedirect(){
    		  window.location= "/my-projects";
    	  }

    	  $("#downloadSample").click(function(){
    		  window.location="/download/sample-config";
        	});
    	  

    	 $("#uploadBtn").click(function(){
    		 
    		 var input_type = $("#input_type").val();
    		 var input_file = $("#input_file").val();
    		 var config_file = $("#config_file").val();
    		 
    		 if(input_file == ""){
    			 alert("Select input file");
    			 return false;
    		 }
    		 if(config_file == ""){
    			 alert("Select config file");
    			 return false;
    		 }
    		 console.log(new FormData($('#uploadForm')[0]));
    		
    		 $("#uploadBtn").attr("disabled", true); 
    		 $("#uploadBtn").css({'cursor' : 'wait'});
             $.ajax({
                 url: baseUrl+'api/t2m-trigger',
                 type:'post',
                 data: new FormData($('#uploadForm')[0]),
                 processData: false,
                 contentType: false,
                 success:function(data){
                     if(data.success == true)
                     {
                    	alert("Project uploaded");
                    	setTimeout(sendRedirect, 1000);
                        
                     }
                     else
                     {
                    	 alert(data.message);
                    	 setTimeout(sendRedirect, 1000);
                    	 //showAlert("Unauthorized! \nPlease check Client ID and Secret","danger")
                     }
                 },
                 error:function(e){
                	 alert("Unable to process request. Please contact support.");
                 },
                 complete:function(xhr,status){
                	 $("#uploadBtn").css({'cursor' : 'default'});
                	 $("#uploadBtn").attr("disabled", false); 
                	 setTimeout(sendRedirect, 1000);
                 }
             });
    		 return false;
         });
      
    });

      </script>
   </body>
</html>